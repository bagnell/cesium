<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">  <!-- Use Chrome Frame in IE -->
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <meta name="cesium-sandcastle-labels" content="Geometries">
    <title>Cesium Demo</title>
    <script type="text/javascript" src="../Sandcastle-header.js"></script>
    <script type="text/javascript" src="../../../ThirdParty/requirejs-2.1.9/require.js"></script>
    <script type="text/javascript">
    require.config({
        baseUrl : '../../../Source',
        waitSeconds : 60
    });
    </script>
</head>
<body class="sandcastle-loading" data-sandcastle-bucket="bucket-requirejs.html" data-sandcastle-title="Cesium + require.js">
<style>
    @import url(../templates/bucket.css);
    #toolbar {
        width: 90%;
        box-sizing: border-box;
    }
</style>
<div id="cesiumContainer" class="fullSize"></div>
<div id="loadingOverlay"><h1>Loading...</h1></div>
<div id="toolbar"></div>
<script id="cesium_sandcastle_script">
require(['Cesium'], function(Cesium) {
    "use strict";
    
    var widget = new Cesium.CesiumWidget('cesiumContainer');
    var scene = widget.scene;
    scene.debugShowFramesPerSecond = true;
    
    (function (scene) {
	    function selectMenuOption(menu, options) {
	        options[menu.selectedIndex].onselect();
	    }
	    
	    var toggleOITMethod = [];
	    
	    // render one frame to check for MRT support
	    scene.initializeFrame();
	    scene.render();
	    
	    if (scene._translucentMRTSupport) {
	        toggleOITMethod.push({
	            text : 'Use Multiple Render Targets for OIT',
	            onselect : function() {
	                scene._translucentMRTSupport = true;
	                scene._translucentMultipassSupport = false;
	            }
	        });
	    }
	    
	    // render another frame with MRT disabled to check for multipass support
	    scene._translucentMRTSupport = false;
	    scene._translucentMultipassSupport = true;
	    scene.initializeFrame();
        scene.render();
        
	    if (scene._translucentMultipassSupport) {
            toggleOITMethod.push({
                text : 'Use Multiple Passes for OIT',
                onselect : function() {
                    scene._translucentMRTSupport = false;
                    scene._translucentMultipassSupport = true;
                }
            });
	    }
	    
	    // bounding volume sorting is always supported
	    toggleOITMethod.push({
            text : 'Use Bounding Volume Sorting',
            onselect : function() {
                scene._translucentMRTSupport = false;
                scene._translucentMultipassSupport = false;
            }
        });
	    
	    // reset to best method
	    toggleOITMethod[0].onselect();
	    
	    Sandcastle.addToolbarMenu(toggleOITMethod, function() {
            selectMenuOption(this, toggleOITMethod);
        });
	    
	    var toggleFXAAOptions = [ {
            text : 'FXAA Enabled',
            onselect : function() {
                scene.fxaaOrderIndependentTranslucency = true;
            }
        }, {
            text : 'FXAA Disabled',
            onselect : function() {
                scene.fxaaOrderIndependentTranslucency = false;
            }
        }];
    
        Sandcastle.addToolbarMenu(toggleFXAAOptions, function() {
            selectMenuOption(this, toggleFXAAOptions);
        });
        
        var text = document.createElement('input');
        text.type = 'text';
        text.value = scene.weightFunction;
        text.setAttribute('spellcheck', 'false');
        text.style.cssText = 'background: rgba(30,30,30,0.7); color: #eee; padding: 2px 5px; border-radius: 4px; border: 1px solid #555; width: 95%;';
        document.getElementById('toolbar').appendChild(text);
        
        var errorElement = document.createElement('div');
        errorElement.style.cssText = 'color: #f00; font-weight: bold; margin: 0 2px; background: rgba(100,0,0,0.55); padding: 2px 5px; display: block; width: 95%;';
        errorElement.style.display = 'none';
        document.getElementById('toolbar').appendChild(errorElement);
        
        scene.onError.addEventListener(function (message) {
            errorElement.style.display = 'block';
            errorElement.textContent = message;
        });
        
        text.addEventListener('keydown', function(e) {
            if (e.keyCode === 13) {
                scene.weightFunction = text.value;
                errorElement.style.display = 'none';
            }
        });
    })(scene);
    
    var primitives = scene.primitives;
    var ellipsoid = widget.centralBody.ellipsoid;
    
    var modelMatrix = Cesium.Matrix4.multiplyByTranslation(
        Cesium.Transforms.eastNorthUpToFixedFrame(ellipsoid.cartographicToCartesian(Cesium.Cartographic.fromDegrees(-75.0, 40.0))),
        new Cesium.Cartesian3(0.0, 0.0, 500000.0));

    var outerEllipsoidInstance = new Cesium.GeometryInstance({
        geometry : new Cesium.EllipsoidGeometry({
            vertexFormat : Cesium.PerInstanceColorAppearance.VERTEX_FORMAT,
            radii : new Cesium.Cartesian3(500000.0, 500000.0, 500000.0)
        }),
        modelMatrix : modelMatrix,
        attributes : {
            color : Cesium.ColorGeometryInstanceAttribute.fromColor(new Cesium.Color(0.0, 1.0, 0.0, 0.5))
        }
    });
    
    var innerEllipsoidInstance = new Cesium.GeometryInstance({
        geometry : new Cesium.EllipsoidGeometry({
            vertexFormat : Cesium.PerInstanceColorAppearance.VERTEX_FORMAT,
            radii : new Cesium.Cartesian3(250000.0, 250000.0, 250000.0)
        }),
        modelMatrix : modelMatrix,
        attributes : {
            color : Cesium.ColorGeometryInstanceAttribute.fromColor(new Cesium.Color(1.0, 0.0, 0.0, 0.5))
        }
    });

    var boxGeometryInstance = new Cesium.GeometryInstance({
        geometry : Cesium.BoxGeometry.fromDimensions({
            vertexFormat : Cesium.PerInstanceColorAppearance.VERTEX_FORMAT,
            dimensions : new Cesium.Cartesian3(750000.0, 750000.0, 750000.0)
        }),
        modelMatrix : modelMatrix,
        attributes : {
            color : Cesium.ColorGeometryInstanceAttribute.fromColor(new Cesium.Color(1.0, 0.0, 0.0, 0.5))
        }
    });
    
    primitives.add(new Cesium.Primitive({
        geometryInstances : [boxGeometryInstance],
        appearance : new Cesium.PerInstanceColorAppearance({
            translucent : true,
            closed : true
        })
    }));
    
    primitives.add(new Cesium.Primitive({
        geometryInstances : [outerEllipsoidInstance],
        appearance : new Cesium.PerInstanceColorAppearance({
            translucent : true,
            closed : true
        })
    }));
    
    var redExtentInstance = new Cesium.GeometryInstance({
        geometry : new Cesium.ExtentGeometry({
            extent : Cesium.Extent.fromDegrees(-110.0, 20.0, -100.0, 30.0),
            vertexFormat : Cesium.PerInstanceColorAppearance.VERTEX_FORMAT
        }),
        attributes: {
            color: Cesium.ColorGeometryInstanceAttribute.fromColor(new Cesium.Color(1.0, 0.0, 0.0, 0.5))
        }
    });
    
    var yellowExtentInstance = new Cesium.GeometryInstance({
        geometry : new Cesium.ExtentGeometry({
            extent : Cesium.Extent.fromDegrees(-105.0, 25.0, -95.0, 35.0),
            vertexFormat : Cesium.PerInstanceColorAppearance.VERTEX_FORMAT,
            height : 100000.0
        }),
        attributes: {
            color: Cesium.ColorGeometryInstanceAttribute.fromColor(new Cesium.Color(1.0, 1.0, 0.0, 0.5))
        }
    });
    
    var blueExtentInstance = new Cesium.GeometryInstance({
        geometry : new Cesium.ExtentGeometry({
            extent : Cesium.Extent.fromDegrees(-100.0, 30.0, -90.0, 40.0),
            vertexFormat : Cesium.PerInstanceColorAppearance.VERTEX_FORMAT,
            height : 200000.0
        }),
        attributes: {
            color: Cesium.ColorGeometryInstanceAttribute.fromColor(new Cesium.Color(0.0, 0.0, 1.0, 0.5))
        }
    });
    
    primitives.add(new Cesium.Primitive({
        geometryInstances : [redExtentInstance, yellowExtentInstance, blueExtentInstance],
        appearance : new Cesium.PerInstanceColorAppearance({
            translucent : true
        })
    }));

    Sandcastle.finishedLoading();
});
</script>
</body>
</html>
